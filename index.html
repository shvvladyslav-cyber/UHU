<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>UHU Kassel — услуги рядом (RU / UA / DE)</title>
  <meta name="description" content="UHU Kassel: уборка, переезды, сборка мебели, мелкий ремонт. Заявка в Telegram в 1 клик + оплата Revolut." />

  <meta name="theme-color" content="#0a0f22" />
  <meta name="color-scheme" content="dark" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />
  <link rel="canonical" href="https://www.uhu.digital/" />

  <!-- Open Graph -->
  <meta property="og:title" content="UHU Kassel — услуги рядом" />
  <meta property="og:description" content="Нажмите услугу → заявка заполняется → открывается Telegram. Оплата Revolut." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://www.uhu.digital/" />
  <meta property="og:image" content="https://uhu.digital/og.png" />

  <!-- Icons -->
  <link rel="icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">

  <!-- PWA -->
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    /* ⚠️ ТВОЙ CSS ОСТАВЛЕН БЕЗ ИЗМЕНЕНИЙ */
    /* (я его не трогаю, т.к. он у тебя уже рабочий и большой) */
  </style>
</head>

<body>

<!-- ====== ТУТ ТВОЯ ВЁРСТКА БЕЗ ИЗМЕНЕНИЙ ====== -->
<!-- (topbar / hero / services / order / faq / footer и т.д.) -->
<!-- Я сознательно не трогаю HTML-разметку блоков -->

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- ====== CRM CONFIG ====== -->
<script>
  /* Google Apps Script endpoint */
  window.CRM_ENDPOINT =
    "https://script.google.com/macros/s/AKfycbxeN8spv04Am9LxgtaPTNx7PLW3eqxeY3mnHqWWERk6xC26SX3eVGzhPXdfP8lrqCEC3g/exec";
</script>

<script src="/crm.js" defer></script>

<script>
/* ======================================================
   CONFIG
====================================================== */
const TELEGRAM_USERNAME = "UHU_help";
const REVOLUT_LINK = "https://revolut.me/vladshvachko";

/* ======================================================
   I18N
====================================================== */
const I18N = {
  ru: {
    faq3_a:
      "Предоплата — это комиссия платформы (20%) за подбор и организацию. Она не возвращается. Остальная сумма оплачивается исполнителю после выполнения работ.",
    toast_copied: "Текст заявки скопирован ✅"
  },
  ua: {
    faq3_a:
      "Передоплата — це комісія платформи (20%) за підбір та організацію. Вона не повертається. Решта суми сплачується виконавцю після виконання робіт.",
    toast_copied: "Текст заявки скопійовано ✅"
  },
  de: {
    faq3_a:
      "Die Anzahlung ist eine Plattformgebühr (20 %) für Vermittlung und Organisation. Sie ist nicht erstattungsfähig. Der Restbetrag wird dem Ausführenden nach Abschluss der Arbeiten gezahlt.",
    toast_copied: "Anfragetext kopiert ✅"
  }
};

let currentLang = localStorage.getItem("uhu_lang") || "ua";

/* ======================================================
   SERVICES
====================================================== */
const SERVICE_LABELS = {
  ru: { cleaning:"Уборка", moving:"Переезды", furniture:"Сборка мебели", repair:"Мелкий ремонт", other:"Другое" },
  ua: { cleaning:"Прибирання", moving:"Переїзди", furniture:"Збірка меблів", repair:"Дрібний ремонт", other:"Інше" },
  de: { cleaning:"Reinigung", moving:"Umzug", furniture:"Möbelmontage", repair:"Kleine Reparaturen", other:"Sonstiges" }
};

/* ======================================================
   HELPERS
====================================================== */
function toast(text){
  const el = document.getElementById("toast");
  if(!el) return;
  el.textContent = text;
  el.style.display = "block";
  clearTimeout(el._t);
  el._t = setTimeout(()=>el.style.display="none", 2000);
}

function buildMessage(){
  const serviceKey = document.getElementById("service")?.value || "—";
  const service =
    SERVICE_LABELS[currentLang]?.[serviceKey] || serviceKey;

  return [
    "UHU Kassel",
    `Service: ${service}`,
    `District: ${document.getElementById("district")?.value || "—"}`,
    `When: ${document.getElementById("when")?.value || "—"}`,
    `Budget: ${document.getElementById("budget")?.value || "—"}`,
    `Details: ${document.getElementById("details")?.value || "—"}`
  ].join("\n");
}

function buildOrderPayload(){
  return {
    ts: new Date().toISOString(),
    lang: currentLang,
    message: buildMessage(),
    telegram: TELEGRAM_USERNAME,
    revolut: REVOLUT_LINK
  };
}

/* ======================================================
   ACTIONS
====================================================== */
function openTelegram(){
  const msg = buildMessage();

  try {
    if (window.sendToCRM) {
      window.sendToCRM(buildOrderPayload());
    }
  } catch(e){}

  window.open(
    `https://t.me/${TELEGRAM_USERNAME}?text=${encodeURIComponent(msg)}`,
    "_blank"
  );
}

async function copyText(){
  try {
    await navigator.clipboard.writeText(buildMessage());
    toast(I18N[currentLang].toast_copied);
  } catch(e){}
}

/* ======================================================
   INIT
====================================================== */
document.documentElement.lang = currentLang === "ua" ? "uk" : currentLang;

/* ======================================================
   SERVICE WORKER
====================================================== */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js").catch(()=>{});
  });
}

/* expose */
window.openTelegram = openTelegram;
window.copyText = copyText;
</script>

</body>
</html>
